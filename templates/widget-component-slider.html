{% extends 'site-layout.html' %}

{% block content %}
    <!-- start content -->
    <div class="content">

        <div id="twentytwenty-{{component_id}}" class="twentytwenty-container">
            <!-- The before image is first -->
            <img src="http://placehold.it/400x200&amp;text=1" width="400" height="200" />
            <!-- The after image is last -->
            <img src="http://placehold.it/400x200&amp;text=2" width="400" height="200" />
        </div>

        <ul>
            <li>Component ID: {{component_id}}</li>
            <li>Slider Offset: <span id="slider-offset-{{component_id}}" class="slider-offset">{{slider_offset}}</span></li>
        </ul>

        <p>Go to <a href="/">/index</a></p>

       <p id="target-text">Then</p>
       {% if requests_list %}
       <h3>Requests</h3>

       <ol>
           {% for request in requests_list %}

           <li>{{ request }}</li>
           
           {% endfor %}
       </ol>
       {% endif %}

       <script>
        //
        Wix.addEventListener( Wix.Events.SETTINGS_UPDATED, updateWidgetComponentSlider );
        Wix.addEventListener( Wix.Events.SITE_SAVED, publishWidgetComponentSlider );

        //
        function updateWidgetComponentSlider( e ){

            console.log( "updateWidgetComponentSlider called.");
            console.log( e );

            document.getElementById( "slider-offset-{{component_id}}" ).innerHTML = e.sliderOffset;
        }
        
        //
        function publishWidgetComponentSlider( e ){

            console.log( "publishWidgetComponentSlider called.");
            console.log( e );

            var sliderOffset =  document.getElementById( "slider-offset-{{component_id}}" ).innerHTML
            console.log(" =")
            console.log(sliderOffset)

            fetch( "{{ url_for('widget_component_slider') }}", {
                method: "POST",
                body: JSON.stringify({
                    componentID: "{{component_id}}",
                    sliderOffset: sliderOffset
                }),
                headers: {
                "Content-type": "application/json; charset=UTF-8"
                }
            });
        }
       </script>

       <script>

        var sliderOffset = Number( "{{slider_offset}}" )
        $(function(){
            $("#twentytwenty-{{component_id}}").twentytwenty({
                default_offset_pct: sliderOffset, // How much of the before image is visible when the page loads
            });
        });
       </script>
    </div>
{% endblock %}
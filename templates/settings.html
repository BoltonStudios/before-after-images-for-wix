{% extends 'site-layout.html' %}

{% block content %}
    <!-- start content -->
    <div class="container p-0">

        <div class="row">
            <div class="d-flex align-items-start">
                <!--Settings Navigation-->
                <div class="nav flex-column nav-pills p-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                    <button class="nav-link active" id="v-pills-main-tab" 
                        data-bs-toggle="pill" 
                        data-bs-target="#v-pills-main" 
                        type="button" 
                        role="tab" 
                        aria-controls="v-pills-main" 
                        aria-selected="true">
                        Main
                    </button>
                    <button class="nav-link" id="v-pills-images-tab"
                        data-bs-toggle="pill"
                        data-bs-target="#v-pills-images"
                        type="button"
                        role="tab"
                        aria-controls="v-pills-images"
                        aria-selected="false">
                        Images
                    </button>
                    <button class="nav-link" id="v-pills-options-tab"
                        data-bs-toggle="pill"
                        data-bs-target="#v-pills-options"
                        type="button"
                        role="tab"
                        aria-controls="v-pills-options"
                        aria-selected="false">
                        Options
                    </button>
                    <hr>
                    <button class="nav-link" id="v-pills-support-tab"
                        data-bs-toggle="pill"
                        data-bs-target="#v-pills-support"
                        type="button"
                        role="tab"
                        aria-controls="v-pills-support"
                        aria-selected="false">
                        Support
                    </button>

                </div>
                <!--Tab Content-->
                <div class="tab-content mx-auto" id="v-pills-tabContent" style="width: 100%;">

                    <!--Main-->
                    <div class="tab-pane fade show active" id="v-pills-main" role="tabpanel" aria-labelledby="v-pills-main-tab">

                        <div class="container-fluid mt-4 p-3  text-center">
                            <div class="row">
                                <div class="col">
                        
                                    <p><img src="{{ url_for('static', filename='images/baie-logo.svg') }}" style="border-radius: 70px;" alt="Baie logo" width="70" height="70"/></p>
                                    <p class="fw-light">Easily compare two images with before-and-after image sliders.</p>
                                    <button class="btn btn-primary" type="button" role="button" onclick="changeBaieSettingsTab( trigger = '#v-pills-images-tab' )">Add Images</button>
                                </div>
                            </div>
                        </div>
                        <script>
                            // Select the given tab by its trigger and shows its associated pane
                            // Source: https://getbootstrap.com/docs/5.0/components/navs-tabs/#show
                            function changeBaieSettingsTab( trigger ){

                                // Initialize variables.
                                var tabTrigger = document.querySelector( trigger )
                                var tab = new bootstrap.Tab(tabTrigger)

                                // Show the associated tab pane.
                                tab.show()
                            }
                            
                        </script>
                    </div>
                    
                    <!--Images-->
                    <div class="tab-pane fade" id="v-pills-images" role="tabpanel" aria-labelledby="v-pills-images-tab">

                        <div class="container-fluid text-bg-light mb-2 px-4 py-3 border-bottom">
                            <div class="row">
                                <div class="col">
                                    <h5 class="fw-light">Images</h5>
                                </div>
                            </div>
                        </div>
                        
                        <!--Before Image-->
                        <div id="baie-before-image" class="baie-image-select container-fluid px-4 py-3" data-baie-image-type="before" data-baie-image="{{ before_image }}">

                            <div class="row mb-2">
                                <div class="col-auto">
                                    <h6>Before</h6>
                                </div>
                                <div class="col">
                                    <p></p>
                                    <button class="btn btn-primary btn-sm" type="button">Select Image</button>
                                </div>
                            </div>

                            {% if before_image != '' %}
                            <div class="row">
                                <div class="col">
                                    <img src="{{ before_image }}" class="img-thumbnail mb-3" width="220" height="113" />
                                </div>
                            </div>
                            {% endif %}
                        </div>

                        <!--After Image-->
                        <div id="baie-after-image" class="baie-image-select container-fluid px-4 py-3" data-baie-image-type="after" data-baie-image="{{ after_image }}">

                            <div class="row mb-2">
                                <div class="col-auto">
                                    <h6>After</6>
                                </div>
                                <div class="col">
                                    <p></p>
                                    <button class="btn btn-primary btn-sm" type="button">Select Image</button>
                                </div>
                            </div>
                            
                            {% if after_image != '' %}
                            <div class="row">
                                <div class="col">
                                    <img src="{{ after_image }}" class="img-thumbnail mb-3" width="220" height="113" />
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!--Options-->
                    <div class="tab-pane fade" id="v-pills-options" role="tabpanel" aria-labelledby="v-pills-options-tab">
                        <div class="container-fluid text-bg-light mb-2 px-4 py-3 border-bottom">
                            <div class="row">
                                <div class="col">
                                    <h5 class="fw-light">Options</h5>
                                </div>
                            </div>
                        </div>
                        <div class="container px-4 py-3">
                            <div class="row">
                                <div class="col-9">
                                    <!--Slider Offset-->
                                    <label for="sliderOffsetRange" class="form-label">Slider Offset</label><br>
                                    <input type="range" class="form-range" id="sliderOffsetRange" onchange="updateBaieComponent()" value="{{ slider_offset }}">
                                </div>
                                <div class="col-3">
                                    <br>
                                    <p class="fs-5"><span id="sliderOffsetNumber">{{ slider_offset }}</span>%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!--Support-->
                    <div class="tab-pane fade" id="v-pills-support" role="tabpanel" aria-labelledby="v-pills-support-tab">
                        <div class="container-fluid text-bg-light mb-2 px-4 py-3 border-bottom">
                            <div class="row">
                                <div class="col">
                                    <h5 class="fw-light">Support</h5>
                                </div>
                            </div>
                        </div>
                        <div class="container-fluid px-4 py-3">
                            <div class="row">
                                <div class="col">
                                    <p class="fw-light">Component ID: {{component_id}}</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        
        <script>
            
            function updateBaieImages( event, element ){

                    // Declare variables.
                var imageURL = '';
                var imageType = element.dataset.baieImageType;
                var beforeStatus = document.querySelector( "#baie-before-image p" );
                var afterStatus = document.querySelector( "#baie-after-image p" );

                // openMediaDialog(mediaType, multiSelect, onSuccess, \[onCancel\])
                // https://dev.wix.com/api/iframe-sdk/sdk/wix.settings#sdk_wix.settings_openmediadialog
                Wix.Settings.openMediaDialog(
                    Wix.Settings.MediaType.IMAGE, // mediaType
                    false, // multiSelect
                    function( data ){
                        // onSuccess
                        // fullSizeImageURL = Wix.Utils.Media.getImageUrl( data.relativeUri );
                        thumbnailURL = Wix.Utils.Media.getResizedImageUrl( data.relativeUri, 220, 113 )
                        imageURL = Wix.Utils.Media.getResizedImageUrl( data.relativeUri, 637, 328 )
                        
                        // Add the image URL to the data attribute.
                        element.dataset.baieImage = imageURL;

                        // Update the labels in the settings panel.
                        if( imageType == "before" ) {
                            
                            beforeStatus.innerHTML = imageURL;
                        }

                        if( imageType == "after" ) {
                            
                            afterStatus.innerHTML = imageURL;
                        }

                        // Update the component to reflect the settings changes.
                        updateBaieComponent()
                    }
                );
            }
            document.getElementById( "baie-before-image" ).addEventListener( "click", function( event ){
                updateBaieImages( event, this )
            });
            document.getElementById( "baie-after-image" ).addEventListener( "click", function( event ){
                updateBaieImages( event, this )
            });

            function updateBaieComponent(){
                
                // Initialize variables.
                var beforeImage = document.getElementById( "baie-before-image" ).dataset.baieImage;
                var afterImage = document.getElementById( "baie-after-image" ).dataset.baieImage;
                var sliderOffset = document.getElementById( "sliderOffsetRange" ).value;
                var sliderOffsetFloat = parseFloat( sliderOffset ) / 100;

                // Prepare message.
                var message = {
                    beforeImage: beforeImage,
                    afterImage: afterImage,
                    sliderOffset: sliderOffset,
                    sliderOffsetFloat: sliderOffsetFloat
                };

                // Manipulate settings panel.
                document.getElementById( "sliderOffsetNumber" ).innerHTML = sliderOffset;

                // Print status update to the console.
                console.log( "updateBaieComponent() called." );
                console.log( "message = " );
                console.log( message );
                
                // Send event.
                Wix.Settings.triggerSettingsUpdatedEvent( message, '{{component_id}}' );
            }
        </script>
    </div>
{% endblock %}